<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forms Reforged — Form Foundry (Beta)</title>
  <meta name="description" content="A full, client-side web app inspired by Forms Reforged — diagnose inherited ideals, reforge better ones, and export your blueprints. No server required." />
  <link rel="canonical" href="https://www.shunyapublications.com/form.html" />

  <!-- Social -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Forms Reforged — Form Foundry" />
  <meta property="og:description" content="Diagnose the ideals you live by. Reforge them. Export as Markdown/JSON. 100% client-side." />
  <meta property="og:image" content="/images/Logosh.png" />
  <meta property="og:url" content="https://www.shunyapublications.com/form.html" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Icons (safe fallbacks) -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <meta name="theme-color" content="#1565ff">
  <!-- License (machine-readable) -->
  <link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">

  <style>
    /* =========================
       Shunya UI — light theme
       ========================= */
    :root{
      --bg:#ffffff; --bg-1:#fff9f1; --bg-2:#f3f9ff; --bg-3:#eef9f5;
      --ink:#142036; --muted:#5a6b88;
      --line:#e6ecf5; --line-strong:#cfd8e6;
      --brand:#1565ff; --brand-2:#ff7a3d; --brand-3:#15a085; --accent:#7d4dff; --gold:#f6b73c;
      --shadow:0 12px 30px rgba(21,101,255,.10);
      --shadow-soft:0 10px 24px rgba(20,32,54,.10);
      --ring:0 0 0 4px rgba(21,101,255,.16);
      --radius:16px; --radius-lg:20px;
      --font:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      --fs-hero:clamp(2rem,3vw,2.6rem); --fs-h2:clamp(1.4rem,1.8vw,1.9rem); --fs-h3:1.12rem;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:var(--font);color:var(--ink);background:var(--bg);
      background:
        radial-gradient(1100px 620px at 10% -10%, var(--bg-1) 0%, #fff 60%),
        radial-gradient(1200px 720px at 110% 110%, var(--bg-2) 0%, #fff 55%),
        radial-gradient(1000px 650px at -10% 120%, var(--bg-3) 0%, #fff 50%);
    }
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:1180px;margin:auto;padding:0 20px}
    .section{padding:64px 0;border-top:1px solid var(--line)}
    .section:first-of-type{border-top:none}

    /* Nav */
    .nav{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{height:42px;width:42px;border-radius:10px;box-shadow:var(--shadow-soft)}
    .brand span{font-weight:800}
    .menu a{margin-left:18px;color:var(--muted);font-weight:600}
    .menu a:hover{color:var(--ink)}

    /* Buttons */
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 14px;border-radius:14px;border:1px solid var(--line);background:linear-gradient(180deg,#fff,#f6fbff);box-shadow:var(--shadow);color:var(--ink);font-weight:600}
    .btn:hover{box-shadow:var(--ring)}
    .btn:focus-visible{outline:none;box-shadow:var(--ring)}
    .btn.brand{background:linear-gradient(180deg,#f7fbff,#eaf2ff);border-color:#dbe7ff}
    .btn.soft{background:#fff;border-color:var(--line)}
    .btn.outline{background:#fff;border-style:dashed}
    .btn.warn{background:linear-gradient(180deg,#fff6f4,#ffe9e3);border-color:#ffd2c5}
    .btn.success{background:linear-gradient(180deg,#eefcf6,#dbf7ea);border-color:#c7f0dc}

    /* Cards & layout */
    .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow-soft)}
    .card-lg{padding:20px;border-radius:var(--radius-lg)}
    .eyebrow{font-size:.8rem;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
    .stack{display:flex;flex-direction:column;gap:12px}
    .grid{display:grid;gap:16px}

    /* Hero */
    header{padding:72px 0 36px}
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:28px;align-items:center}
    .title{font-size:var(--fs-hero);line-height:1.12;margin:6px 0}
    .subtitle{color:#2a3b5c;opacity:.95;max-width:68ch}

    /* App Layout */
    .cols{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    .tool{padding:16px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f0f6ff;border:1px solid #dbe7ff;color:#1565ff;font-weight:700;font-size:.78rem}

    /* Inputs */
    .row{display:flex;gap:10px;flex-wrap:wrap}
    label{font-weight:600}
    input[type="text"], input[type="url"], textarea, select{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#fff;color:var(--ink)}
    textarea{min-height:110px}

    /* Right rail */
    .rail .card + .card{margin-top:12px}

    /* Vault table */
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;vertical-align:top}
    tr:hover{background:#fafcff}

    /* Footer */
    footer .footer-bar{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;color:var(--muted)}
    /* License helper */
    .license-note{margin-top:6px;font-size:.9rem;color:var(--muted)}
    .license-note a{text-decoration:underline}

    /* Responsive */
    @media (max-width:980px){.hero,.cols{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav" aria-label="Global">
    <div class="container nav-inner">
      <a class="brand" href="/index.html">
        <img src="/images/Logosh.png" alt="Shunya Publications Logo" />
        <span>Shunya Publications</span>
      </a>
      <div class="menu" role="navigation">
        <a href="/index.html">Home</a>
        <a href="/services.html">Services</a>
      
         <a href="books.html" aria-current="page">Books</a>
          <a href="journal.html">Journals</a>
        <a href="/research.html">Research</a>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="section">
    <div class="container hero">
      <div>
        <p class="eyebrow">Forms Reforged</p>
        <h1 class="title">Form Foundry — Diagnose, Reforge, Export</h1>
        <p class="subtitle">A practical, research-led tool based on <em>Forms Reforged</em> by Shunya. Audit the blueprints shaping your life and culture, design better ones, and share them with your team or classroom. 100% client-side — your data stays in your browser.</p>
        <div class="row" style="margin-top:8px">
         <a class="btn primary" href="https://amazon.com/author/shunya_" target="_blank" rel="noopener">📖 Browse Founder’s Books on Amazon</a>
          <a class="btn brand" href="#start">↓ Start forging</a>
          <a class="btn soft" href="https://a.co/d/9bX7yl9" target="_blank" rel="noopener">📘 Read the book</a>
        </div>
      </div>
      <aside class="card card-lg">
        <div class="stack">
          <div class="pill">Quick Links</div>
          <a class="btn" href="#wizard">Form Foundry Wizard</a>
          <a class="btn" href="#vault">Your Vault</a>
          <a class="btn" href="#quizzes">Cave & Integrity Quizzes</a>
          <a class="btn" href="#export">Export & Share</a>
        </div>
      </aside>
    </div>
  </header>

  <!-- APP -->
  <main id="start" class="section">
    <div class="container cols">
      <!-- Left: Wizard -->
      <section id="wizard" class="card card-lg tool" aria-labelledby="wizard-title">
        <div class="row" style="justify-content:space-between;align-items:center">
          <h2 id="wizard-title" style="margin:0;font-size:var(--fs-h2)">Form Foundry Wizard</h2>
          <span class="pill" id="draftStatus">Draft · unsaved</span>
        </div>

        <!-- Stepper Nav -->
        <div class="row" style="margin:10px 0 2px;flex-wrap:wrap">
          <button class="btn soft" data-step="1">1 · Diagnose</button>
          <button class="btn soft" data-step="2">2 · Extract Essence</button>
          <button class="btn soft" data-step="3">3 · Reimagine Blueprint</button>
          <button class="btn soft" data-step="4">4 · Embody & Ritualize</button>
          <button class="btn soft" data-step="5">5 · Share & Metrics</button>
        </div>

        <!-- FORM -->
        <form id="foundry" class="stack" style="margin-top:8px">
          <!-- Meta -->
          <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
            <div>
              <label for="title">Form Title *</label>
              <input id="title" name="title" required placeholder="e.g., A Humane Success Model" />
            </div>
            <div>
              <label for="domain">Domain</label>
              <input id="domain" name="domain" placeholder="e.g., Work, Education, Identity, Beauty" />
            </div>
          </div>

          <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
            <div>
              <label for="author">Author / Team</label>
              <input id="author" name="author" placeholder="Your name or group" />
            </div>
            <div>
              <label for="source">Source / Links</label>
              <input id="source" name="source" placeholder="References, readings, URLs" />
            </div>
          </div>

          <!-- Step 1 -->
          <fieldset data-step="1" class="card">
            <legend><b>1) Diagnose the Inherited Form</b></legend>
            <div class="stack">
              <label for="inherited">Describe the current ideal you’ve been using (the inherited Form). Who authored it, who benefits, where did you absorb it?</label>
              <textarea id="inherited" name="inherited" placeholder="Describe the blueprint you’ve been living by…"></textarea>

              <label for="harms">Harms & misfits — how does this Form exhaust, exclude, or distort?</label>
              <textarea id="harms" name="harms" placeholder="List misalignments, harms, exclusions…"></textarea>

              <label for="signals">Signals it’s failing — what frictions, contradictions, or hypocrisies do you notice?</label>
              <textarea id="signals" name="signals" placeholder="e.g., constant burnout, performative metrics, shame loops…"></textarea>
            </div>
          </fieldset>

          <!-- Step 2 -->
          <fieldset data-step="2" class="card">
            <legend><b>2) Extract the Essence</b></legend>
            <div class="stack">
              <label for="essence">What’s worth preserving? Distill the enduring value inside the old Form.</label>
              <textarea id="essence" name="essence" placeholder="e.g., deep contribution, craftsmanship, community…"></textarea>

              <label for="constraints">Context & constraints — what’s true now that wasn’t when the old Form arose?</label>
              <textarea id="constraints" name="constraints" placeholder="e.g., remote work, attention economy, care responsibilities…"></textarea>
            </div>
          </fieldset>

          <!-- Step 3 -->
          <fieldset data-step="3" class="card">
            <legend><b>3) Reimagine the Blueprint</b></legend>
            <div class="stack">
              <label for="definition">Your new definition (clear, positive, flexible without vagueness)</label>
              <textarea id="definition" name="definition" placeholder="Write the new ideal in 2–4 sentences…"></textarea>

              <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
                <div>
                  <label for="pillars">Pillars (3–6)</label>
                  <textarea id="pillars" name="pillars" placeholder="List the core pillars or principles…"></textarea>
                </div>
                <div>
                  <label for="anti">Anti-patterns (what this is NOT)</label>
                  <textarea id="anti" name="anti" placeholder="Name the traps you will avoid…"></textarea>
                </div>
              </div>

              <label for="rituals">Practices & rituals (weekly/daily behaviors that make the Form real)</label>
              <textarea id="rituals" name="rituals" placeholder="Design small, repeatable rituals…"></textarea>

              <label for="symbols">Symbols & language (metaphors, visuals, names)</label>
              <textarea id="symbols" name="symbols" placeholder="Give it a name, imagery, and shared vocabulary…"></textarea>
            </div>
          </fieldset>

          <!-- Step 4 -->
          <fieldset data-step="4" class="card">
            <legend><b>4) Embody & Ritualize</b></legend>
            <div class="stack">
              <label for="roles">Roles & responsibilities (who does what?)</label>
              <textarea id="roles" name="roles" placeholder="Individuals, teams, stakeholders, feedback loops…"></textarea>

              <label for="friction">Friction plan (where will this fail? pre-mortem)</label>
              <textarea id="friction" name="friction" placeholder="List foreseeable obstacles and counter-moves…"></textarea>

              <label for="timeline">Timeline (pilot → adopt → iterate)</label>
              <textarea id="timeline" name="timeline" placeholder="Outline 30/60/90-day phases…"></textarea>
            </div>
          </fieldset>

          <!-- Step 5 -->
          <fieldset data-step="5" class="card">
            <legend><b>5) Share & Metrics</b></legend>
            <div class="stack">
              <label for="audience">Audience & adoption (who needs to see/use this?)</label>
              <textarea id="audience" name="audience" placeholder="Stakeholders, partners, classrooms…"></textarea>

              <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
                <div>
                  <label for="metrics">Success metrics (leading & lagging)</label>
                  <textarea id="metrics" name="metrics" placeholder="What will improve if this Form works?"></textarea>
                </div>
                <div>
                  <label for="ethics">Ethics guardrails</label>
                  <textarea id="ethics" name="ethics" placeholder="Non-negotiables; consent, inclusion, transparency…"></textarea>
                </div>
              </div>

              <label for="license">License / attribution</label>
              <input id="license" name="license" value="CC BY-SA 4.0 — Attribute ‘Forms Reforged — Shunya Publications’" />
            </div>
          </fieldset>

          <div class="row" style="justify-content:flex-end;gap:10px">
            <button type="button" class="btn success" id="saveDraft">💾 Save Draft</button>
            <button type="button" class="btn outline" id="exportMd">⬇ Export Markdown</button>
            <button type="button" class="btn outline" id="exportJson">⬇ Export JSON</button>
            <button type="reset" class="btn warn" id="clearForm">↺ Clear</button>
          </div>
        </form>
      </section>

      <!-- Right: Rail -->
      <aside class="rail">
        <!-- Quizzes -->
        <section id="quizzes" class="card card-lg">
          <h3 style="margin:0 0 6px;font-size:var(--fs-h3)">Quick Quizzes</h3>
          <p class="eyebrow">Perception & alignment checks</p>

          <details open class="card">
            <summary><b>Cave Flicker Check</b> — Are you living by shadows?</summary>
            <div class="stack" style="margin-top:8px">
              <label for="flicker">When a belief comforts me, I:</label>
              <select id="flicker">
                <option value="2">interrogate it</option>
                <option value="1" selected>bookmark and move on</option>
                <option value="0">defend it online</option>
              </select>
              <label for="noise">My media diet is:</label>
              <select id="noise">
                <option value="2">diverse & deliberate</option>
                <option value="1" selected>mixed</option>
                <option value="0">algorithm all the way</option>
              </select>
              <button class="btn soft" id="scoreCave">Score</button>
              <p id="caveOut" class="eyebrow" aria-live="polite"></p>
            </div>
          </details>

          <details class="card">
            <summary><b>Ideal Integrity Gauge</b> — Is your new Form humane?</summary>
            <div class="stack" style="margin-top:8px">
              <label for="humility">Humility toward dissent</label>
              <select id="humility">
                <option value="2" selected>welcomes critique</option>
                <option value="1">tolerates</option>
                <option value="0">punishes</option>
              </select>
              <label for="inclusion">Inclusion by design</label>
              <select id="inclusion">
                <option value="2">explicit</option>
                <option value="1" selected>implicit</option>
                <option value="0">absent</option>
              </select>
              <button class="btn soft" id="scoreIntegrity">Score</button>
              <p id="intOut" class="eyebrow" aria-live="polite"></p>
            </div>
          </details>

  
        </section>

        <!-- Vault -->
        <section id="vault" class="card card-lg" aria-labelledby="vault-title">
          <div class="row" style="justify-content:space-between;align-items:center">
            <h3 id="vault-title" style="margin:0;font-size:var(--fs-h3)">Your Vault</h3>
            <button class="btn soft" id="newEntry">＋ New</button>
          </div>
          <p class="eyebrow">Saved locally to your browser. Export for backups.</p>
          <div id="vaultTableWrap" class="card" style="overflow:auto">
            <table id="vaultTable" aria-describedby="vault-title">
              <thead>
                <tr><th>Title</th><th>Domain</th><th>Updated</th><th style="width:160px">Actions</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </aside>
    </div>
  </main>

  <!-- EXPORT HELP -->
  <section id="export" class="section">
    <div class="container">
      <article class="card card-lg">
        <h3 style="margin:0 0 6px;font-size:var(--fs-h3)">Export & Share</h3>
        <p>Use <b>Export Markdown</b> to generate a clean document for proposals, workshops, or classrooms. <b>Export JSON</b> lets you re-import later. Everything runs locally; we don’t see your data.</p>
        <div class="row">
          <button class="btn outline" id="copyLink">🔗 Copy shareable URL (encodes your draft)</button>
          <button class="btn soft" id="printDoc">🖨️ Print / Save as PDF</button>
        </div>
      </article>
    </div>
  </section>

  <!-- FOOTER -->
<footer class="section" style="padding:24px 0">
  <div class="container footer-bar">
    <div>
      Copyright © <span id="y"></span> Shunya Publications. All rights reserved. · Built for <em>Forms Reforged</em>
    </div>

    <!-- License note (additive; nothing removed) -->
    <div class="license-note">
      Content on this page (tool text, prompts, templates) is licensed under
      <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="license noopener">CC BY-SA 4.0</a>.
      Logos/wordmarks and the book <em>Forms Reforged</em> are excluded (all rights reserved).
      Preferred attribution: “Forms Reforged — Form Foundry (Beta) by Shunya Publications (CC BY-SA 4.0).”
      <br><br>
      <b>Cite as:</b> Akhtar, M. A. K. (Shunya). <i>Forms Reforged — Form Foundry (Beta)</i>. Shunya Publications. CC BY-SA 4.0.
      <br>
      📚 <a href="https://a.co/d/9bX7yl9" target="_blank" rel="noopener">Read the full book on Amazon</a>
    </div>
  </div>
</footer>


  <script>
  // Utility helpers
  const $ = (s,root=document)=>root.querySelector(s);
  const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
  const byId = id => document.getElementById(id);
  const nowStr = ()=> new Date().toISOString().replace('T',' ').slice(0,16);

  // Stepper: scroll the chosen fieldset into view
  $$("[data-step]").forEach(btn=>{
    if(btn.tagName==='BUTTON'){
      btn.addEventListener('click',()=>{
        const step = btn.getAttribute('data-step');
        const fs = document.querySelector('fieldset[data-step="'+step+'"]');
        if(fs){ fs.scrollIntoView({behavior:'smooth',block:'start'}); fs.classList.add('pulse'); setTimeout(()=>fs.classList.remove('pulse'),600); }
      });
    }
  });

  // Draft state & save
  const form = byId('foundry');
  const draftStatus = byId('draftStatus');
  const STORAGE_KEY = 'forms_reforged_v1';
  let vault = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');

  function formToObj(){
    const data = Object.fromEntries(new FormData(form).entries());
    data.updated = Date.now();
    return data;
  }
  function objToForm(d){
    Object.entries(d||{}).forEach(([k,v])=>{ const el = byId(k); if(!el) return; if(el.tagName==='INPUT' || el.tagName==='TEXTAREA') el.value = v; });
  }
  function markDirty(){ draftStatus.textContent = 'Draft · unsaved'; }
  form.addEventListener('input', markDirty);

  byId('saveDraft').addEventListener('click', ()=>{
    const data = formToObj();
    if(!data.title){ alert('Please enter a Form Title before saving.'); return; }
    const idx = vault.findIndex(x=>x.title===data.title);
    if(idx>-1) vault[idx] = data; else vault.unshift(data);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(vault));
    renderVault();
    draftStatus.textContent = 'Saved · ' + nowStr();
  });

  // Vault UI
  function renderVault(){
    const tbody = $('#vaultTable tbody');
    tbody.innerHTML = '';
    vault.forEach(item=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>\${escapeHtml(item.title||'—')}</td>
        <td>\${escapeHtml(item.domain||'—')}</td>
        <td>\${new Date(item.updated||Date.now()).toLocaleString()}</td>
        <td>
          <button class="btn soft" data-act="load" data-id="\${encodeURIComponent(item.title)}">Load</button>
          <button class="btn outline" data-act="md" data-id="\${encodeURIComponent(item.title)}">MD</button>
          <button class="btn warn" data-act="del" data-id="\${encodeURIComponent(item.title)}">Delete</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }
  function getByTitle(title){ return vault.find(v=>v.title===title); }
  $('#vaultTable').addEventListener('click', e=>{
    const b = e.target.closest('button'); if(!b) return;
    const title = decodeURIComponent(b.getAttribute('data-id'));
    if(b.dataset.act==='load'){ objToForm(getByTitle(title)); draftStatus.textContent='Loaded'; }
    if(b.dataset.act==='del'){
      if(confirm('Delete "'+title+'" from this browser?')){
        vault = vault.filter(v=>v.title!==title);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(vault));
        renderVault();
      }
    }
    if(b.dataset.act==='md'){
      const item = getByTitle(title); if(item) downloadText(toMarkdown(item), (title||'form')+'.md');
    }
  });
  byId('newEntry').addEventListener('click', ()=>{ form.reset(); markDirty(); });

  // Exporters
  function toMarkdown(d){
    d = d||formToObj();
    const esc = s=> (s||'').trim();
    return `# \${esc(d.title)}

`+
`**Domain:** \${esc(d.domain)}  
**Author/Team:** \${esc(d.author)}  
**Updated:** \${nowStr()}

---

`+
`## 1) Diagnose the Inherited Form
\${esc(d.inherited)}

**Harms & Misfits**
\${esc(d.harms)}

**Signals It’s Failing**
\${esc(d.signals)}

---

`+
`## 2) Extract the Essence
\${esc(d.essence)}

**Context & Constraints**
\${esc(d.constraints)}

---

`+
`## 3) Reimagine the Blueprint
**Definition**
\${esc(d.definition)}

**Pillars**
\${esc(d.pillars)}

**Anti-patterns**
\${esc(d.anti)}

**Practices & Rituals**
\${esc(d.rituals)}

**Symbols & Language**
\${esc(d.symbols)}

---

`+
`## 4) Embody & Ritualize
**Roles & Responsibilities**
\${esc(d.roles)}

**Friction Plan**
\${esc(d.friction)}

**Timeline**
\${esc(d.timeline)}

---

`+
`## 5) Share & Metrics
**Audience & Adoption**
\${esc(d.audience)}

**Success Metrics**
\${esc(d.metrics)}

**Ethics Guardrails**
\${esc(d.ethics)}

**License**
\${esc(d.license)}
`;
  }
  function downloadText(text, filename){
    const blob = new Blob([text], {type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download=filename; a.click();
    setTimeout(()=>URL.revokeObjectURL(url), 500);
  }
  byId('exportMd').addEventListener('click', ()=> downloadText(toMarkdown(), (byId('title').value||'form')+'.md'));
  byId('exportJson').addEventListener('click', ()=> downloadText(JSON.stringify(formToObj(),null,2), (byId('title').value||'form')+'.json'));

  // Shareable URL — encode form as base64 in hash
  byId('copyLink').addEventListener('click', ()=>{
    const data = formToObj();
    const b64 = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
    const u = new URL(location.href); u.hash = 'data='+b64;
    navigator.clipboard.writeText(u.toString()).then(()=> alert('Link copied! Anyone with the link can load your draft (local only).'))
      .catch(()=> alert('Copy failed — copy from address bar after it updates.'));
  });
  // If hash present, load
  (function(){
    const h = new URL(location.href).hash.replace(/^#/, '');
    const m = h.match(/data=(.+)$/);
    if(m){
      try{ const obj = JSON.parse(decodeURIComponent(escape(atob(m[1])))); objToForm(obj); draftStatus.textContent='Loaded from link'; }
      catch{}
    }
  })();

  // Print
  byId('printDoc').addEventListener('click', ()=> window.print());

  // Clear
  byId('clearForm').addEventListener('click', ()=> setTimeout(()=> draftStatus.textContent='Cleared', 0));

  // Quizzes logic
  byId('scoreCave').addEventListener('click', ()=>{
    const s = Number(byId('flicker').value) + Number(byId('noise').value);
    const out = byId('caveOut');
    out.textContent = s>=3 ? 'You’re exiting the cave. Keep seeking disconfirming evidence.' : (s===2 ? 'Mixed: add a weekly “shadow check” (sources you disagree with).' : 'Shadow-bound: reduce algorithmic feeds; schedule silent thinking.');
  });
  byId('scoreIntegrity').addEventListener('click', ()=>{
    const s = Number(byId('humility').value) + Number(byId('inclusion').value);
    const out = byId('intOut');
    out.textContent = s>=3 ? 'Strong integrity: this Form is unlikely to become a cudgel.' : (s===2 ? 'Borderline: formalize critique & inclusion rituals.' : 'Fragile: risks oppression. Add dissent channels & explicit guardrails.');
  });

  // Escape HTML for table
  function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

  // Init
  renderVault();
  byId('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
